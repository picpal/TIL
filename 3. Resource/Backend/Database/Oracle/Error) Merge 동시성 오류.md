# 오류 상황
- 서로 다른 세션에서 동시에 Merge 문 실행
- Merge문을 실행하였음에도, 2개의 insert 가 발생하여 중복 데이터 발생

<br />

# ChatGPT 오류 검색

## ChatGPT 질문
```
오라클 DBA는 SQL 전문가입니다. 정확한 사실만을 판단하여 답변하고, 사실적 근거가 없는 경우 정확한 데이터를 도출해야 합니다. 다음 질문에 단계별로 답변하세요.  
Q: 오라클에서 동일한 병합을 동시에 실행하면 삽입이 두 번 실행되나요?
```

## ChatGPT 답변
```
Oracle은 트랜잭션 격리 수준을 제공하여 동시성 문제를 다룹니다. 기본적으로 Oracle은 READ COMMITTED 격리 수준을 사용합니다. 이 격리 수준에서 다른 세션에서 수행한 변경 내용을 COMMIT하기 전까지는 해당 변경 내용을 볼 수 없습니다.

따라서 동시에 동일한 MERGE INTO 문을 실행하는 경우, 첫 번째 세션이 INSERT 구문을 실행하고 COMMIT하기 전까지 해당 변경 내용은 다른 세션에서는 보이지 않습니다. 그러나 두 번째 세션이 COMMIT하기 전에 첫 번째 세션이 COMMIT을 수행하면, 두 번째 세션에서도 INSERT 구문이 실행되어 데이터가 중복으로 삽입될 수 있습니다.

이러한 동시성 문제를 해결하기 위해서는 여러 가지 방법을 사용할 수 있습니다. 예를 들어, MERGE INTO 문을 실행하는 동안 해당 테이블에 대한 락을 설정하여 다른 세션에서의 접근을 제한할 수 있습니다. 또는 고유한 제약 조건(UNIQUE 제약 조건 등)을 사용하여 중복 삽입을 방지할 수도 있습니다.

```

<br />

이와 비슷한 예로 PK가 걸려있어도 insert가 두번 실행되긴 하는데, 이에 따라 PK 무결성 오류가 나타남. 
그래서 무결성 오류에 대한 예외처리로 방어코드를 수행해야함. 